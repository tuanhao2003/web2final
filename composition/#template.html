<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css">
<!-- style template -->
<style>
    .img-flu img {
        width: 100% !important;
        object-fit: cover;
    }

    .img-flu-vertical img {
        height: 100% !important;
        object-fit: cover;
    }
</style>

<!-- hidden menu -->
<div class="container">
    <button type="button" data-bs-toggle="collapse" data-bs-target="#collapseItems" aria-controls="CollapseItems"
        aria-label="Toggle navigation" aria-expanded="false">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse" id="collapseItems">
        <!-- content -->
    </div>
</div>

<!-- popup sidebar -->
<div class="offcanvas offcanvas-start" id="popupSide">
    <div class="container">
        <div class="offcanvas-header">
            <h1 class="offcanvas-title">
                <!-- title -->
            </h1>
        </div>
        <div class="offcanvas-body">

            <!-- content -->

        </div>
    </div>
</div>
<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#popupSide">
    open
</button>

<!-- slide -->
<div id="mega-slider" class="carousel slide" data-bs-ride="carousel">

    <div class="carousel-inner">
        <div class="carousel-item img-flu active">
            <img src="" alt=".">
        </div>
        <div class="carousel-item img-flu">
            <img src="" alt=".">
        </div>
        <div class="carousel-item img-flu">
            <img src="" alt=".">
        </div>
    </div>

    <ol class="carousel-indicators">
        <li data-bs-target="#mega-slider" data-bs-slide-to="0" class="active" aria-current="true"></li>
        <li data-bs-target="#mega-slider" data-bs-slide-to="1"></li>
        <li data-bs-target="#mega-slider" data-bs-slide-to="2"></li>
    </ol>


    <a class="carousel-control-prev" href="#mega-slider" role="button" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </a>
    <a class="carousel-control-next" href="#mega-slider" role="button" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </a>
</div>

<!-- puzzel shape -->
<style>
    :root {
        --puzW: 300px;
        --puzH: 300px;
        --puzBg: rgb(150, 150, 150);

        --edgeW: calc(var(--puzH)/3);
        --edgeH: calc(var(--puzH)/3);
        --edgeBg: rgb(255, 255, 255);

        --edgePosx: calc(-1*var(--edgeW)/5);
        --edgePosy: calc(-1*var(--edgeH)/5);

        --edge-Posx: calc(-1*(var(--edgeW)/5*4));
        --edge-Posy: calc(-1*(var(--edgeH)/5*4));

        --width-center: calc(var(--puzW)/2 - var(--edgeW)/2);
        --height-center: calc(var(--puzH)/2 - var(--edgeH)/2);
    }

    .puzzel {
        position: relative;
        width: var(--puzW);
        height: var(--puzH);
        background: var(--puzBg);
        z-index: 0;
    }

    .puzzel .t {
        position: absolute;
        width: var(--edgeW);
        height: var(--edgeH);
        left: var(--width-center);
        top: var(--edge-Posy);
        background-color: var(--puzBg);
        border-radius: 50%;
    }

    .puzzel .r {
        position: absolute;
        width: var(--edgeW);
        height: var(--edgeH);
        right: var(--edge-Posx);
        top: var(--height-center);
        background-color: var(--puzBg);
        border-radius: 50%;
    }

    .puzzel .b {
        position: absolute;
        width: var(--edgeW);
        height: var(--edgeH);
        left: var(--width-center);
        bottom: var(--edgePosy);
        background-color: var(--edgeBg);
        border-radius: 50%;
    }

    .puzzel .l {
        position: absolute;
        width: var(--edgeW);
        height: var(--edgeH);
        left: var(--edgePosx);
        top: var(--height-center);
        background-color: var(--edgeBg);
        border-radius: 50%;
    }

    .puzzel .center {
        text-align: center;
    }
</style>
<div class="puzzel">
    <div class="t"><br></div>
    <div class="r"><br></div>
    <div class="b"><br></div>
    <div class="l"><br></div>
    <span class="center">ok</span>
</div>

<!-- slide 2 -->
<div class="swiper-js-container">
    <div class="swiper-container swiper-container-initialized swiper-container-horizontal"
        data-swiper-direction="horizontal" data-swiper-autoplay="true" data-swiper-autoplay-delay="5000"
        data-swiper-loop="true" data-swiper-space-between="15" data-swiper-row-items="1" data-swiper-lg-items="3"
        data-swiper-md-items="3" data-swiper-sm-items="1">
        <div class="swiper-wrapper">
            <div class="swiper-slide swiper-slide-active img-flu" data-swiper-slide-index="0">
                <img src="." alt=".">
            </div>

            <div class="swiper-slide swiper-slide-next img-flu" data-swiper-slide-index="1">
                <img src="." alt=".">
            </div>

            <div class="swiper-slide swiper-slide-prev img-flu" data-swiper-slide-index="2">
                <img src="." alt=".">
            </div>
        </div>
    </div>
</div>

<!-- animation -->
<div class="animate__animated animate__fadeInLeft" data-enet-animationtype="animate__fadeInLeft"
    style="animation-delay: 0.5s;">
</div>

<!-- thêm link từ body -->
<script>
    let link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = '';

    document.head.appendChild(link);
</script>

<!-- w và h trong bs5 10 20 25 40 50 75 80 100 -->
<!-- xoay vòng -->
<style type="text/css">
    .eci-gastronomy-rotate {
        display: block;
        position: relative;
    }

    .eci-gastronomy-rotate .item_1 {
        position: absolute;
        animation: rotateUp 0.5s forwards;

    }

    .eci-gastronomy-rotate:hover>.item_1 {
        animation: rotateDown 0.5s;
    }

    .eci-gastronomy-rotate .item_2 {
        position: absolute;
        animation: rotateDown 0.5s forwards;
    }

    .eci-gastronomy-rotate:hover>.item_2 {
        animation: rotateUp 0.5s;
    }



    @keyframes rotateDown {
        0% {
            transform-origin: bottom;
            transform: rotate(0deg);
            transition: 0.4s linear;
        }

        100% {
            transform-origin: bottom;
            transform: rotate(180deg);
            transition: 0.4s linear;
        }
    }

    @keyframes rotateUp {
        0% {
            transform-origin: bottom;
            transform: rotate(-180deg);
            transition: 0.4s linear;
        }

        100% {
            transform-origin: bottom;
            transform: rotate(0deg);
            transition: 0.4s linear;
        }
    }
</style>

<!-- background fixed -->
<style>
    .bg-fixed {
        background-image: url();
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
    }
</style>

<!-- remove sform's empty datas -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.duLieuKham').forEach(element => {
            if (element.innerHTML == '') {
                element.parentElement.style.display = "none";
            }
        });
        if (element.parentElement.parentElement.querySelectorAll('.duLieuKham').length == 0) {
            element.parentElement.parentElement.style.display = "none";
        }
    });
</script>

<!-- multi image fit adjust-->
<style type="text/css">
    .img-flu {
        display: flex;
        justify-content: space-between;
        width: 100%;
        height: 100%;
        flex-direction: row;
        flex-wrap: wrap;
    }

    .img-flu:has(img:nth-child(2)) img {
        width: 50% !important;
        height: 100%;
    }

    .img-flu:has(img:nth-child(3)) img {
        width: 30% !important;
        height: 100%;
    }

    .img-flu:has(img:nth-child(4)) img {
        width: 25% !important;
        height: 100%;
    }
</style>

<!-- sync input data (set sync class = syncForm) -->
<script>
    (
        function () {
            document.querySelectorAll(".syncForm .form-control").forEach(elem => {
                if (elem.tagName == "TEXTAREA") {
                    CKEDITOR.on('instanceReady', function () {
                        if (typeof CKEDITOR !== 'undefined' && CKEDITOR.instances[elem.getAttribute("name")]) {
                            let cke = CKEDITOR.instances[elem.getAttribute("name")];
                            document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']").value = cke.getData();
                            CKEDITOR.instances["tongKet_" + elem.getAttribute("name")].setData(document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']").value);
                        }
                    });
                    CKEDITOR.on('instanceReady', function () {
                        if (typeof CKEDITOR !== 'undefined' && CKEDITOR.instances[elem.getAttribute("name")]) {
                            let cke = CKEDITOR.instances[elem.getAttribute("name")];
                            cke.on("blur", function () {
                                document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']").value = cke.getData();
                                CKEDITOR.instances["tongKet_" + elem.getAttribute("name")].setData(document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']").value);
                            })
                        }
                    });
                } else {
                    if (document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']") != null) {
                        document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']").value = elem.value;
                    }
                    elem.addEventListener("blur", function () {
                        if (document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']") != null) {
                            document.querySelector(".form-control[name='tongKet_" + elem.getAttribute("name") + "']").value = elem.value;
                        }
                    });
                }
            });
        }
    )();
</script>

<!-- draw area -->

<div class="signContainer d-flex justify-content-evenly align-items-center">
    <canvas class="form-control-sm border-2 border-dashed border border-warning rounded-5 signInput" height="100"
        name="signName" width="200"></canvas>
    <div style="text-align: center;">
        <a class="btn rounded-3 btn-primary signBtn mb-2 w-75">Xác nhận</a>
        <a class="w-75 resetBtn btn rounded-3 btn-secondary">reset</a>
    </div>
    <input class="form-control signImg d-none" data-cke-saved-name="signImg" name="signImg" type="text"
        data-cke-editable="1" contenteditable="false">
</div>

<script>
    (function () {
        let containers = document.querySelectorAll(".signContainer");
        containers.forEach(container => {

            let mousex = 0, mousey = 0;
            let drawable = false;
            let drawarea = container.querySelector(".signInput");
            let context = drawarea.getContext("2d");
            let saveBtn = container.querySelector("a.btn.signBtn");
            let resetBtn = container.querySelector("a.btn.resetBtn");
            let imgInput = container.querySelector("input.signImg");
            let previousSign = new Image();
            previousSign.src = imgInput.dataset.prev;

            context.drawImage(previousSign, 0, 0);

            function start(e) {
                mousex = e.offsetX;
                mousey = e.offsetY;
                drawable = true;
            }
            function end() {
                if (drawable == true) {
                    mousex = 0;
                    mousey = 0;
                    drawable = false;
                }
            }
            function draw(e) {
                if (drawable == true) {
                    let currentX = e.offsetX;
                    let currentY = e.offsetY;
                    context.beginPath();
                    context.strokeStyle = "black";
                    context.lineWidth = "1";
                    context.moveTo(mousex, mousey);
                    context.lineTo(currentX, currentY);
                    context.closePath()
                    context.stroke();
                    mousex = currentX;
                    mousey = currentY;
                }
            }

            drawarea.addEventListener("mousedown", start);
            document.addEventListener("mouseup", end);
            drawarea.addEventListener("mousemove", draw);

            saveBtn.addEventListener("click", function () {
                alert("Đã lưu chữ ký");
                let base64Img = drawarea.toDataURL('image/png');

                imgInput.value = base64Img;
                imgInput.dataset.prev = base64Img;
            });

            resetBtn.addEventListener("click", function () {
                context.clearRect(0, 0, drawarea.width, drawarea.height);
                imgInput.value = "";
                imgInput.dataset.prev = base64Img;
            });
        });
    })();
</script>

<!--########################## test area ##########################-->




<!--########################## test area ##########################-->



<!-- not done yet -->
<script>
    (function () {
        let root = document.querySelectorAll('.hideEmptyData');
        // can xu ly lai dieu kien cho nay
        function allEmpty(elem) {
            if (elem.querySelectorAll('> .duLieuKham').length == elem.querySelectorAll('> .duLieuKham[style="display: none;"]').length || elem.children.length == 0) {
                return true;
            }
            return false;
        }

        function findAndHide(root) {
            let open = [];
            let closed = [];
            let elem = root;

            open.push(elem);
            while (true) {
                if (elem.querySelectorAll('.duLieuKham').length == 0) {
                    closed.push(elem);
                    open.splice(open.indexOf(elem), 1);
                }
                if (allEmpty(elem)) {
                    elem.style.display = "none";
                    closed.push(elem);
                    open.splice(open.indexOf(elem), 1);
                } else {
                    Array.from(elem.children).forEach(child => {
                        if (!closed.includes(child) && !open.includes(child))
                            open.push(child)
                    });
                }

                if (open.length == 0) {
                    break
                } else {
                    elem = open.pop();
                }
            }
        }

        root.forEach(branch => {
            branch.querySelectorAll('.duLieuKham').forEach(data => {
                if (data.innerHTML == "") {
                    data.style.display = "none";
                }
            });

            findAndHide(branch);
        });
    })();
</script>